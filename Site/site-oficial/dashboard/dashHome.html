<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipeline Consultancy | DashBoard Home</title>
    <link rel="stylesheet" href="../assets/css/dashHome.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="sidebar">
        <img src="../assets/images/logoNomeSemFundo.png" alt="">

        <div class="user-section">
            <img src="../assets/images/user.webp" alt="Usu√°rio" class="user-icon">
            <p class="user-role">Analista</p>
        </div>

        <div class="menu">
            <button class="menu-btn" onclick="redirecionarHome()">Home</button>
            <button class="menu-btn" onclick="redirecionarAlerta()">Alertas</button>
            <button class="menu-btn" onclick="redirecionarComparar()">Compara√ß√£o</button>
        </div>

        <div class="logout-section">
            <button class="logout-btn" onclick="sair()">Sair</button>
        </div>
    </div>

    <div class="main-content">
        <div class="filters">
            <select id="sensorSelect">
                <option value="" disabled>Escolha um sensor</option>
                <option value="Sensor 1" selected>Sensor 1</option>
                <option value="Sensor 2">Sensor 2</option>
                <option value="Sensor 3">Sensor 3</option>
            </select>

            <select id="timeSelect">
                <option value="" disabled>Escolha o tempo</option>
                <option value="Tempo real" selected>Tempo real</option>
                <option value="Horas do Dia">Horas do Dia</option>
                <option value="Dias da Semana">Dias da Semana</option>
            </select>
        </div>

        <div class="dashboard">
            <div class="left-panel">
                <div class="indicator-row">
                    <div class="indicator-wrapper">
                        <div class="indicator" style="color: rgb(251, 38, 38); box-shadow: 0 0 10px rgb(255, 0, 0); ">
                            <span>Quantidade de dutos criticos</span>
                            <p>3</p>
                        </div>
                        <div class="indicator" style="color: yellow; box-shadow: 0 0 10px rgb(255, 255, 0);">
                            <span>Quantidade de dutos em alerta</span>
                            <p>3</p>
                        </div>
                    </div>

                    <div class="middle-panel">
                        <div class="pizza-container">
                            <p style="font-size: 1.2rem;">üñ≤Ô∏è <strong>Situa√ß√£o dos Sensores</strong></p>
                            <canvas id="pizzaChart" width="300" height="120"></canvas>
                        </div>
                    </div>

                </div>
                <div class="chart-area">
                    <div class="chart-container">
                        <h3 class="chart-title">üõ¢Ô∏è Fluxo do Petr√≥leo</h3>
                        <canvas id="realtimeChart" height="90" width="240"></canvas>
                    </div>
                </div>
            </div>

            <div class="right-panel">
                <div class="sensor-status-container">
                    <h3>üì° Status dos Sensores</h3>
                    <ul class="sensor-status-list">
                        <li><span class="sensor-name">Sensor 1 - Duto 1 </span><span class="status critical">Cr√≠tico</span></li>
                        <li><span class="sensor-name">Sensor 2 - Duto 1 </span><span class="status critical">Cr√≠tico</span></li>
                        <li><span class="sensor-name">Sensor 3 - Duto 2 </span><span class="status alert">Alerta</span></li>
                        <li><span class="sensor-name">Sensor 4 - Duto 2 </span><span class="status stable">Est√°vel</span></li>
                        <li><span class="sensor-name">Sensor 5 - Duto 3 </span><span class="status alert">Alerta</span></li>
                        <li><span class="sensor-name">Sensor 6 - Duto 3 </span><span class="status critical">Cr√≠tico</span></li>
                        <li><span class="sensor-name">Sensor 7 - Duto 4 </span><span class="status stable">Est√°vel</span></li>
                        <li><span class="sensor-name">Sensor 8 - Duto 4 </span><span class="status alert">Alerta</span></li>
                        <li><span class="sensor-name">Sensor 9 - Duto 5 </span><span class="status stable">Est√°vel</span></li>
                        <li><span class="sensor-name">Sensor 9 - Duto 5 </span><span class="status alert">Alerta</span></li>
                </div>
            </div>
        </div>
</body>

</html>

<script>

    function redirecionarHome() { window.location.href = 'dashHome.html' };
    function redirecionarAlerta() { window.location.href = 'dashAlerta.html' };
    function redirecionarComparar() { window.location.href = 'dashComparacao.html' };
    function sair() { window.location.href = '../home.html' }

</script>

<script>
   // Fun√ß√µes para redirecionar para as p√°ginas correspondentes do dashboard
function redirecionarHome() { 
    window.location.href = 'dashHome.html'; 
};
function redirecionarAlerta() { 
    window.location.href = 'dashAlerta.html'; 
};
function redirecionarComparar() { 
    window.location.href = 'dashComparacao.html'; 
};
function sair() { 
    window.location.href = '../home.html'; 
}

// Obt√©m o contexto do canvas onde ser√° desenhado o gr√°fico de linha (gr√°fico de fluxo de petr√≥leo)
const ctx = document.getElementById('realtimeChart').getContext('2d');

// Define os intervalos de valores m√≠nimos e m√°ximos para cada sensor
const sensores = {
    "Sensor 1": { min: 15, max: 40 },
    "Sensor 2": { min: 25, max: 60 },
    "Sensor 3": { min: 30, max: 80 }
};

// Captura os elementos dos <select> de sensor e tempo
const selectSensor = document.getElementById('sensorSelect');
const selectTempo = document.getElementById('timeSelect');

// Estrutura base dos dados do gr√°fico de linha
var data = {
    labels: [],  // Eixo X: ser√° preenchido com hor√°rios ou dias
    datasets: [
        {
            // Linha principal com os valores de dist√¢ncia do sensor
            label: 'Dist√¢ncia',
            borderColor: 'yellow',
            backgroundColor: 'rgba(0,0,255,0.1)',
            data: [],
            tension: 0.4 // Suaviza a curva do gr√°fico
        },
        {
            // Linha de refer√™ncia para o valor m√°ximo
            label: 'M√°ximo',
            borderColor: 'red',
            borderDash: [5, 5], // Linha tracejada
            data: [],
            fill: false,
            pointRadius: 0 // Sem pontos vis√≠veis
        },
        {
            // Linha de refer√™ncia para o valor m√≠nimo
            label: 'M√≠nimo',
            borderColor: 'green',
            borderDash: [5, 5], // Linha tracejada
            data: [],
            fill: false,
            pointRadius: 0
        }
    ]
};

// Configura√ß√µes do gr√°fico de linha (Chart.js)
const config = {
    type: 'line',  // Tipo de gr√°fico
    data: data,    // Dados definidos acima
    options: {
        responsive: true,
        animation: false, // Desativa anima√ß√£o para atualiza√ß√£o r√°pida
        scales: {
            x: {
                title: {
                    display: true,
                    text: 'Hor√°rio',
                    color: 'white'
                },
                ticks: { color: 'white' },
                grid: { color: 'rgba(255,255,255,0.2)' }
            },
            y: {
                title: {
                    display: true,
                    text: 'Dist√¢ncia (cm)',
                    color: 'white'
                },
                ticks: { color: 'white' },
                grid: { color: 'rgba(255,255,255,0.2)' },
                beginAtZero: false,  // N√£o come√ßa no zero
                suggestedMin: 0      // Valor m√≠nimo sugerido para o eixo Y
            }
        },
        plugins: {
            legend: {
                labels: {
                    color: 'white'  // Cor da legenda
                }
            }
        }
    }
};

// Configura√ß√£o do gr√°fico de pizza (situa√ß√£o dos sensores)
const ctxPizza = document.getElementById('pizzaChart').getContext('2d');

// Cria√ß√£o do gr√°fico de pizza
new Chart(ctxPizza, {
    type: 'pie',
    data: {
        labels: ['Cr√≠tico', 'Alerta', 'Est√°vel'], // Legendas das fatias
        datasets: [{
            // Quantidade de cada categoria
            data: [3, 3, 2],
            backgroundColor: [
                'rgba(255, 59, 48, 0.4)',   // Cr√≠tico ‚Äî transl√∫cido
                'rgba(255, 213, 0, 0.4)',   // Alerta ‚Äî transl√∫cido
                'rgba(50, 205, 50, 0.4)'    // Est√°vel ‚Äî transl√∫cido
            ],
            borderColor: [
                '#FF3B30',   // Cr√≠tico ‚Äî s√≥lido
                '#FFD500',   // Alerta ‚Äî s√≥lido
                '#32CD32'    // Est√°vel ‚Äî s√≥lido
            ],
            borderWidth: 3
        }]
    },
    options: {
        plugins: {
            legend: {
                labels: {
                    color: 'white' // Cor das legendas
                }
            }
        }
    }
});

// Instancia o gr√°fico de linha
const realtimeChart = new Chart(ctx, config);

// Vari√°vel para controlar o intervalo de atualiza√ß√£o em tempo real
var intervalo;

// Fun√ß√£o que gera um novo dado e atualiza o gr√°fico
function gerarDado() {
    const sensor = sensores[selectSensor.value]; // Pega o intervalo do sensor selecionado
    const min = sensor.min;
    const max = sensor.max;
    const now = new Date();
    const hora = now.toLocaleTimeString('pt-BR'); // Pega o hor√°rio atual formatado

    // Gera valor aleat√≥rio dentro do intervalo ajustado (+-5 para flutua√ß√£o)
    const valor = Math.floor(Math.random() * (max - min + 10)) + (min - 5);

    // Adiciona hor√°rio no eixo X
    data.labels.push(hora);
    // Adiciona valor do sensor no dataset principal
    data.datasets[0].data.push(valor);
    // Adiciona valores fixos de refer√™ncia no dataset de m√°ximo e m√≠nimo
    data.datasets[1].data.push(max);
    data.datasets[2].data.push(min);

    // Mant√©m o gr√°fico com no m√°ximo 20 pontos (remove o mais antigo)
    if (data.labels.length > 20) {
        data.labels.shift();  // Remove primeiro item do eixo X
        data.datasets.forEach(dataset => dataset.data.shift()); // Remove valores antigos
    }

    // Atualiza o gr√°fico na tela
    realtimeChart.update();
}

// Fun√ß√£o que inicializa ou atualiza o gr√°fico conforme sele√ß√£o de sensor e tempo
function iniciarGrafico() {
    clearInterval(intervalo); // Limpa o intervalo anterior para evitar m√∫ltiplas execu√ß√µes simult√¢neas

    // Limpa os dados existentes no gr√°fico
    data.labels = [];
    data.datasets.forEach(ds => ds.data = []);

    const sensor = sensores[selectSensor.value]; // Obt√©m os limites do sensor atual
    const min = sensor.min;
    const max = sensor.max;

    // Verifica o tipo de tempo selecionado e gera os dados correspondentes
    if (selectTempo.value === "Tempo real") {
        // Atualiza o gr√°fico a cada 1.5 segundos com novo valor aleat√≥rio
        intervalo = setInterval(gerarDado, 1500);

    } else if (selectTempo.value === "Horas do Dia") {
        // Simula dados para cada hora cheia do dia
        for (let h = 0; h < 24; h++) {
            const horaFormatada = `${h.toString().padStart(2, '0')}:00`; // Formata '01:00', '02:00'...
            data.labels.push(horaFormatada);
            const valor = Math.floor(Math.random() * (max - min + 10)) + (min - 5);
            data.datasets[0].data.push(valor);
            data.datasets[1].data.push(max);
            data.datasets[2].data.push(min);
        }
        realtimeChart.update();

    } else if (selectTempo.value === "Dias da Semana") {
        // Simula dados para cada dia da semana
        const dias = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
        dias.forEach(dia => {
            data.labels.push(dia);
            const valor = Math.floor(Math.random() * (max - min + 10)) + (min - 5);
            data.datasets[0].data.push(valor);
            data.datasets[1].data.push(max);
            data.datasets[2].data.push(min);
        });
        realtimeChart.update();
    }
}

// Evento executado quando a p√°gina termina de carregar
window.onload = () => {
    // Define valores padr√µes
    selectSensor.value = "Sensor 1";
    selectTempo.value = "Tempo real";
    // Inicia o gr√°fico com as configura√ß√µes padr√µes
    iniciarGrafico();
};

// Adiciona eventos para atualizar o gr√°fico quando mudar o sensor ou o tempo
selectSensor.addEventListener('change', iniciarGrafico);
selectTempo.addEventListener('change', iniciarGrafico);

</script>