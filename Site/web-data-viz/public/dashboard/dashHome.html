<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipeline Consultancy | DashBoard Home</title>
    <link rel="stylesheet" href="../assets/css/dashHome.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="sidebar">
        <img src="../assets/images/logoNomeSemFundo.png" alt="">

        <div class="user-section">
            <img src="../assets/images/user.webp" alt="Usuário" class="user-icon">
            <p class="user-role">Analista</p>
        </div>

        <div class="menu">
            <button class="menu-btn" onclick="redirecionarHome()">Home</button>
            <button class="menu-btn" onclick="redirecionarAlerta()">Alertas</button>
        </div>

        <div class="logout-section">
            <button class="logout-btn" onclick="sair()">Sair</button>
        </div>
    </div>

    <div class="main-content">
        <div class="filters">
            <select id="statusSelect">
                <option value="1">Critico</option>
                <option value="2">Alerta</option>
                <option value="3">Estavel</option>
            </select>

            <h3></h3>
        </div>
        
        <div class="dashboard">
            <div class="left-panel" id="dutosContainer">
                
            </div>
        </div>
    </div>
    </body>

</html>

<script>

    function redirecionarHome() { window.location.href = 'dashHome.html' };
    function redirecionarAlerta() { window.location.href = 'dashAlerta.html' };
    function sair() { window.location.href = '../index.html' }
    
</script>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/duto/dutos')
            .then(response => response.json())
            .then(data => {
                const dutosContainer = document.getElementById('dutosContainer');
                dutosContainer.innerHTML = ''; // Limpar a div
    
                // Criar um objeto para agrupar os dados por Duto
                const dutos = [];
    
                data.forEach(item => {
                    // Se o duto não existir no objeto dutos, cria um novo
                    if (!dutos[item.idDuto]) {
                        dutos[item.idDuto] = {
                            idDuto: item.idDuto,
                            diametro: item.diametro,
                            sensores: []
                        };
                    }
    
                    // Adiciona o sensor ao duto relacionado
                    dutos[item.idDuto].sensores.push({
                        idSensor: item.idSensor,
                        tipo: item.inicioDuto === 1 ? 'Início' : 'Fim',
                        status: 'Crítico' // Status fixo como 'Crítico' por enquanto
                    });
                });

                console.log(dutos);
    
                // To colocando cada duto
                dutos.forEach(duto => {
                    // Criar o container para o duto
                    const dutoContainer = document.createElement('div');
                    dutoContainer.classList.add('sensor-status-container');
                    
                    // Criar o título do duto
                    const h3 = document.createElement('h3');
                    h3.textContent = `Duto ${duto.idDuto} - Altura: ${duto.diametro}cm`;
                    dutoContainer.appendChild(h3);
    
                    // Criar a lista de sensores
                    const ul = document.createElement('ul');
                    ul.classList.add('sensor-status-list');
                    
                    // Iterar sobre os sensores do duto
                    duto.sensores.forEach(sensor => {
                        const li = document.createElement('li');
                        li.style.gap = '10px';
    
                        // Criar o nome do sensor
                        const spanSensorName = document.createElement('span');
                        spanSensorName.classList.add('sensor-name');
                        spanSensorName.textContent = `Sensor ${sensor.idSensor} - ${sensor.tipo}`;
    
                        // Criar o status do sensor
                        const spanStatus = document.createElement('span');
                        spanStatus.classList.add('status', 'critical'); // Todos como 'Crítico' por enquanto
                        spanStatus.textContent = sensor.status;
    
                        // Adicionar os elementos a lista
                        li.appendChild(spanSensorName);
                        li.appendChild(spanStatus);
                        ul.appendChild(li);
                    });
    
                    // Adicionar a lista de sensores ao container do duto
                    dutoContainer.appendChild(ul);
    
                    // Adicionar o container do duto ao container principal
                    dutosContainer.appendChild(dutoContainer);
                });
            })
            .catch(error => {
                console.error('Erro ao carregar os dados dos dutos:', error);
            });
    });
    </script>
    